{"version":3,"sources":["mongoose/mongoose-model.ts"],"names":[],"mappings":";AAAA,MAAO,QAAQ,WAAW,UAAU,CAAC,CAAC;AACtC,MAAO,CAAC,WAAW,GAAG,CAAC,CAAC;AACxB,gCAA6B,6BAA6B,CAAC,CAAA;AAC3D,+BAA0B,8BAA8B,CAAC,CAAA;AACzD,MAAY,UAAU,WAAM,MAAM,CAAC,CAAA;AACnC,6BAA2B,uBAAuB,CAAC,CAAA;AACnD,MAAY,cAAc,WAAM,yBAAyB,CAAC,CAAA;AAC1D,MAAY,SAAS,WAAM,eAAe,CAAC,CAAA;AAC3C,MAAY,KAAK,WAAM,SAAS,CAAC,CAAA;AAEjC,wBAAwB,wBAAwB,CAAC,CAAA;AACjD,6BAAyB,8BAA8B,CAAC,CAAA;AACxD,qCAAmC,oCAAoC,CAAC,CAAA;AAExE;;;;;;GAMG;AACH,kBAAyB,KAA0B,EAAE,MAAkB;IACnE,IAAI,aAAa,GAAG,EAAE,CAAC;IAEvB,2BAA2B;IAC3B,IAAI,YAAY,GAAG,EAAE,CAAC;IACtB,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,GAAG;QAC/B,IAAI,QAAQ,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACpE,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC5B,aAAa,CAAC,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;IACpF,CAAC,CAAC,CAAC;IAEH,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,aAAa,CAAC;SAC7B,IAAI,CAAC,MAAM;QACR,sCAAsC;QACtC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,SAAS;YAC3C,IAAI,CAAC;gBACD,cAAc,CAAC,4BAA4B,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YAElE,CAAE;YAAA,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACV,uBAAU,CAAC,QAAQ,CAAC,qBAAqB,EAAE,EAAE,CAAC,CAAC;gBAC/C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YACxB,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,MAAM;YACzD,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;QAC5E,CAAC,CAAC;aACG,KAAK,CAAC,KAAK;YACR,uBAAU,CAAC,QAAQ,CAAC,qBAAqB,KAAK,EAAE,CAAC,CAAC;YAClD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAA;IACV,CAAC,CAAC,CAAC;AACX,CAAC;AAhCe,gBAAQ,WAgCvB,CAAA;AAED;;;;;GAKG;AACH,iBAAwB,KAA0B,EAAE,MAAkB;IAClE,IAAI,UAAU,GAAG,EAAE,CAAC;IACpB,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,IAAI,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IACjC,IAAI,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,yBAAyB,EAAE,CAAC;IACxD,IAAI,UAAU,GAAG,EAAE,CAAC;IAEpB,iDAAiD;IACjD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QAC9B,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM;YAC7F,IAAI,QAAQ,GAAG,IAAI,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACvD,OAAO,MAAM,CAAC,GAAG,CAAC;YAClB,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACxE,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,SAAS,EAAE,4BAAY,CAAC,GAAG,CAAC,CAAC;YACtE,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC,CAAC;IACR,CAAC;IAED,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;QAClC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM;YAC5C,gBAAgB;YAChB,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO;gBACpC,MAAM,CAAC,cAAc,CAAC,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG;oBACvD,MAAM,CAAC,OAAO,CAAC;gBACnB,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;YACV,uBAAU,CAAC,QAAQ,CAAC,oBAAoB,KAAK,EAAE,CAAC,CAAC;YACjD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,wCAAwC;IACxC,qBAAqB;IACrB,mDAAmD;IACnD,OAAO;IACP,KAAK;IAEL,iCAAiC;IACjC,uBAAuB;IACvB,wEAAwE;IACxE,QAAQ;IACR,uBAAuB;IACvB,2DAA2D;IAC3D,iCAAiC;IACjC,SAAS;AACb,CAAC;AA9Ce,eAAO,UA8CtB,CAAA;AAED;;;;;GAKG;AACH,mBAA0B,KAA0B,EAAE,MAAkB;IACpE,IAAI,UAAU,GAAG,EAAE,CAAC;IACpB,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;IAC3B,IAAI,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IACjC,IAAI,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,yBAAyB,EAAE,CAAC;IACxD,IAAI,UAAU,GAAG,EAAE,CAAC;IAEpB,iDAAiD;IACjD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QAC9B,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM;YAC7F,IAAI,QAAQ,GAAG,IAAI,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACvD,OAAO,MAAM,CAAC,GAAG,CAAC;YAClB,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACxE,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,SAAS,EAAE,4BAAY,CAAC,KAAK,CAAC,CAAC;YACxE,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC,CAAC;IACR,CAAC;IAED,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;QAClC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM;YAC5C,gBAAgB;YAChB,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO;gBACpC,MAAM,CAAC,cAAc,CAAC,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG;oBACvD,MAAM,CAAC,OAAO,CAAC;gBACnB,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;YACV,uBAAU,CAAC,QAAQ,CAAC,oBAAoB,KAAK,EAAE,CAAC,CAAC;YACjD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;AACP,CAAC;AA/Be,iBAAS,YA+BxB,CAAA;AAED;;;;;;GAMG;AACH,qBAA4B,KAA0B,EAAE,MAAkB,EAAE,GAAQ;IAChF,OAAO,GAAG,CAAC,GAAG,CAAC;IACf,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IACrE,mEAAmE;IACnE,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,IAAI,CAAC,KAAK,CAAC,GAAG;QACV,GAAG,EAAE,MAAM;KACd,CAAC;IACF,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,SAAS,EAAE,4BAAY,CAAC,GAAG,CAAC,CAAC;IACtE,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,IAAI,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;SACnE,IAAI,CAAC,MAAM;QACR,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO;YACvC,MAAM,CAAC,cAAc,CAAC,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG;gBACvD,MAAM,CAAC,MAAM,CAAC;YAClB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,gBAAgB,KAAK,EAAE,CAAC,CAAC;QAC7C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACX,CAAC;AApBe,mBAAW,cAoB1B,CAAA;AAED;;;GAGG;AACH,iBAAwB,KAA0B;IAC9C,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC;SAChC,IAAI,CAAC,MAAM;QACR,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,oBAAoB,KAAK,EAAE,CAAC,CAAC;QACjD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACX,CAAC;AARe,eAAO,UAQtB,CAAA;AAGD;;;;;GAKG;AACH,oBAA2B,KAA0B,EAAE,KAAU;IAE7D,IAAI,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,CAAC;IACzC,oDAAoD;IACpD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE;SACpC,IAAI,CAAC,MAAM;QACR,mCAAmC;QACnC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAC7B,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,uBAAuB,KAAK,EAAE,CAAC,CAAC;QACpD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AAEX,CAAC;AAbe,kBAAU,aAazB,CAAA;AAED,uBAA8B,KAA0B,EAAE,KAAU;IAEhE,IAAI,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,CAAC;IAC5C,oDAAoD;IACpD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE;SACpC,IAAI,CAAC,MAAM;QACR,mCAAmC;QACnC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAC7B,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,0BAA0B,KAAK,EAAE,CAAC,CAAC;QACvD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AAEX,CAAC;AAbe,qBAAa,gBAa5B,CAAA;AAGD;;;;;;;;;GASG;AACH,mBAA0B,KAA0B,EAAE,KAAU,EAAE,MAA4B,EAAE,YAA2B,EAAE,YAAsB,EAAE,IAAU,EAAE,IAAa,EAAE,KAAc;IAC1L,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,EAAE,CAAC,CAAC,MAAM,YAAY,KAAK,CAAC,CAAC,CAAC;QAC1B,MAAM,CAAC,OAAO,CAAC,CAAC;YACZ,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QACf,CAAC,CAAC,CAAC;IACP,CAAC;IACD,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;QACd,GAAG,GAAG,MAAM,CAAC;IACjB,CAAC;IACD,EAAE,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;QACf,EAAE,CAAC,CAAC,YAAY,CAAC,KAAK,IAAI,IAAI,CAAC;YAC3B,KAAK,GAAG,YAAY,CAAC,KAAK,CAAC;QAE/B,EAAE,CAAC,CAAC,YAAY,CAAC,IAAI,IAAI,IAAI,CAAC;YAC1B,IAAI,GAAG,YAAY,CAAC,IAAI,CAAC;QAE7B,EAAE,CAAC,CAAC,YAAY,CAAC,IAAI,IAAI,IAAI,CAAC;YAC1B,IAAI,GAAG,YAAY,CAAC,IAAI,CAAC;IACjC,CAAC;IAED,IAAI,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IACtC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACP,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IACD,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACP,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IACD,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;QACR,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACrC,CAAC;IACD,oDAAoD;IACpD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE;SACpC,IAAI,CAAC,MAAM;QACR,mCAAmC;QACnC,EAAE,CAAC,CAAC,YAAY,IAAI,SAAS,IAAI,YAAY,IAAI,KAAK,CAAC,CAAC,CAAC;YACrD,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAClC,CAAC;QAED,IAAI,UAAU,GAAG,EAAE,CAAC;QACpB,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC;YAC7B,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;YAClC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;QAC7E,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,sBAAsB,KAAK,EAAE,CAAC,CAAC;QACnD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;IACP,qDAAqD;IACrD,2CAA2C;IAC3C,wBAAwB;IACxB,mCAAmC;IACnC,0BAA0B;IAC1B,8DAA8D;IAC9D,wBAAwB;IACxB,UAAU;AACd,CAAC;AA1De,iBAAS,YA0DxB,CAAA;AAED;;;;GAIG;AACH,iBAAwB,KAA0B,EAAE,EAAE;IAClD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;SAC9C,IAAI,CAAC,MAAM;QACR,MAAM,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC;aACvD,IAAI,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACX,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,oBAAoB,KAAK,EAAE,CAAC,CAAC;QACjD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACX,CAAC;AAXe,eAAO,UAWtB,CAAA;AAED;;;;;GAKG;AACH,qBAA4B,KAA0B,EAAE,SAAS,EAAE,KAAK;IACpE,IAAI,KAAK,GAAG,EAAE,CAAC;IACf,KAAK,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC;IACzB,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,KAAK,CAAC;SACtC,IAAI,CAAC,MAAM;QACR,MAAM,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC;aACvD,IAAI,CAAC,CAAC;YACH,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACX,CAAC,EACD,GAAG;QACC,uBAAU,CAAC,QAAQ,CAAC,wBAAwB,GAAG,EAAE,CAAC,CAAC;QACnD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IACzB,CAAC,CAAC,CAAC;AACX,CAAC;AAde,mBAAW,cAc1B,CAAA;AAED;;;;GAIG;AACH,kBAAyB,KAA0B,EAAE,GAAe,EAAE,oBAA8B;IAChG,EAAE,CAAC,CAAC,oBAAoB,IAAI,SAAS,CAAC,CAAC,CAAC;QACpC,oBAAoB,GAAG,KAAK,CAAC;IACjC,CAAC;IACD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC9B,KAAK,EAAE;YACH,GAAG,EAAE,GAAG;SACX;KACJ,CAAC,CAAC,IAAI,CAAC,CAAC,MAAW;QAChB,EAAE,CAAC,CAAC,MAAM,CAAC,MAAM,KAAK,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;YAC/B,IAAI,KAAK,GAAG,oCAAoC,GAAG,MAAM,CAAC,MAAM,GAAG,4BAA4B,GAAG,GAAG,CAAC,MAAM,CAAC;YAC7G,uBAAU,CAAC,QAAQ,CAAC,qBAAqB,KAAK,EAAE,CAAC,CAAC;YAClD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC;QAED,IAAI,UAAU,GAAG,EAAE,CAAC;QACpB,EAAE,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC;YACvB,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC;gBAC7B,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;YACtE,CAAC,CAAC,CAAC;YACH,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;gBAClC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;YAC7E,CAAC,CAAC,CAAC;QACP,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAClC,CAAC;IAEL,CAAC,CAAC,CAAC;AACP,CAAC;AA5Be,gBAAQ,WA4BvB,CAAA;AAED;;;;;;GAMG;AACH,mBAA0B,KAA0B,EAAE,EAAE,EAAE,IAAI;IAC1D,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;SAC9C,IAAI,CAAC,MAAM;QACR,IAAI,GAAG,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,KAAK,GAAG,SAAS,CAAC,gCAAgC,CAAC,wBAAS,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QACnF,EAAE,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;YACzD,oFAAoF;YACpF,IAAI,MAAM,GAAG,EAAE,CAAC;YAChB,MAAM,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;YACnB,MAAM,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC;iBACtD,IAAI,CAAC,CAAC;gBACH,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACxB,CAAC,CAAC,CAAC;QACX,CAAC;QACD,MAAM,CAAC,GAAG,CAAC;IACf,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,sBAAsB,KAAK,EAAE,CAAC,CAAC;QACnD,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACX,CAAC;AAnBe,iBAAS,YAmBxB,CAAA;AAED;;;;GAIG;AACH,cAAqB,KAA0B,EAAE,GAAQ;IACrD,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IACrE,MAAM,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,SAAS,EAAE,IAAI,CAAC;SAC9D,IAAI,CAAC,MAAM;QACR,IAAI,CAAC;YACD,cAAc,CAAC,4BAA4B,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAElE,CAAE;QAAA,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACV,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YAChB,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACxB,CAAC;QACD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM;YACjE,IAAI,MAAM,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YACpC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YAC3B,MAAM,CAAC,GAAG,CAAC;QACf,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,iBAAiB,KAAK,EAAE,CAAC,CAAC;QAC9C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACX,CAAC;AApBe,YAAI,OAoBnB,CAAA;AAED;;;;;;GAMG;AACH,aAAoB,KAA0B,EAAE,EAAO;IACnD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;SACvD,IAAI,CAAC,CAAC,QAAa;QAChB,MAAM,CAAC,cAAc,CAAC,aAAa,CAAC,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;YACvE,MAAM,CAAC,cAAc,CAAC,4BAA4B,CAAC,KAAK,EAAE,4BAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAAC;iBACzF,IAAI,CAAC,GAAG;gBACL,MAAM,CAAC,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;YACnC,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACP,CAAC,CAAC;SACD,KAAK,CAAC,GAAG;QACN,uBAAU,CAAC,QAAQ,CAAC,iBAAiB,GAAG,EAAE,CAAC,CAAC;QAC5C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC;IACtD,CAAC,CAAC,CAAC;AACX,CAAC;AAde,WAAG,MAclB,CAAA;AAED;;;;GAIG;AACH,iBAAwB,KAA0B,EAAE,IAAgB;IAChE,IAAI,UAAU,GAAG,EAAE,CAAC;IACpB,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;QAC3B,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACtB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QACpB,CAAC;QACD,IAAI,CAAC,CAAC;YACF,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChB,CAAC;IACL,CAAC,CAAC,CAAC;IACH,GAAG,CAAC,OAAO,CAAC,CAAC;QACT,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC;SAC1B,IAAI,CAAC,MAAM;QACR,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC;YAC7B,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;gBAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;YAC/B,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;gBAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,GAAG,CAAC;IACf,CAAC,CAAC;SACD,KAAK,CAAC,GAAG;QACN,uBAAU,CAAC,QAAQ,CAAC,kBAAkB,GAAG,EAAE,CAAC,CAAC;QAC7C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;IACtC,CAAC,CAAC,CAAC;AACX,CAAC;AA5Be,eAAO,UA4BtB,CAAA;AAED;;;;;GAKG;AACH,4BAA4B,IAAS,EAAE,SAAiB,EAAE,WAAmB;IACzE,IAAI,kBAAkB,GAAY,KAAK,CAAC;IACxC,IAAI,IAAI,GAAG,yCAAoB,CAAC,IAAI,CAAC,CAAC;IACtC,IAAI,UAAU,GAAG,IAAI,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;IAC9C,IAAI,cAAc,GAAG,UAAU,IAAI,iBAAS,CAAC,WAAW,CAAC,UAAU,EAAE,SAAS,EAAE,WAAW,CAAC,CAAC;IAC7F,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;QACjB,kBAAkB,GAAG,IAAI,CAAC;IAC9B,CAAC;IACD,MAAM,CAAC,kBAAkB,CAAC;AAC9B,CAAC;AACD;;;;;;;GAOG;AACH,aAAoB,KAA0B,EAAE,EAAO,EAAE,GAAQ,EAAE,IAAa;IAC5E,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IACrE,mEAAmE;IACnE,MAAM,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM;QACzE,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,SAAS,EAAE,4BAAY,CAAC,GAAG,CAAC,CAAC;QACtE,IAAI,kBAAkB,GAAG,kBAAkB,CAAC,IAAI,EAAE,uBAAU,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;QACpF,IAAI,KAAK,GAAW,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QAClC,EAAE,CAAC,CAAC,kBAAkB,KAAK,IAAI,CAAC,CAAC,CAAC;YAC9B,YAAY,CAAC,MAAM,CAAC,IAAI,OAAO,YAAY,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC;YAC3D,YAAY,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;YACpC,KAAK,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;QAC9B,CAAC;QACD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC,KAAK,EAAE,YAAY,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC;aAC5E,IAAI,CAAC,MAAM;YACR,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,kBAAkB,KAAK,IAAI,CAAC,CAAC,CAAC;gBACzC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,4EAA4E,CAAC,CAAC;YAClG,CAAC;YACD,MAAM,CAAC,cAAc,CAAC,4BAA4B,CAAC,KAAK,EAAE,4BAAY,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC;iBACxH,IAAI,CAAC,GAAG;gBACL,IAAI,MAAM,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBACpC,MAAM,CAAC,cAAc,CAAC,2BAA2B,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC;oBACnE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;oBACtB,MAAM,CAAC,GAAG,CAAC;gBACf,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;YACV,uBAAU,CAAC,QAAQ,CAAC,gBAAgB,KAAK,EAAE,CAAC,CAAC;YAC7C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;IACX,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,gBAAgB,KAAK,EAAE,CAAC,CAAC;QAC7C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACP,CAAC;AAjCe,WAAG,MAiClB,CAAA;AAED;;;;;;;GAOG;AACH,eAAsB,KAA0B,EAAE,EAAO,EAAE,GAAG,EAAE,IAAa;IACzE,IAAI,SAAS,GAAG,cAAc,CAAC,yBAAyB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;IAErE,mEAAmE;IACnE,MAAM,CAAC,cAAc,CAAC,qBAAqB,CAAC,KAAK,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM;QACzE,IAAI,YAAY,GAAG,KAAK,CAAC,eAAe,CAAC,SAAS,EAAE,4BAAY,CAAC,KAAK,CAAC,CAAC;QACxE,IAAI,kBAAkB,GAAG,kBAAkB,CAAC,IAAI,EAAE,uBAAU,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QACtF,IAAI,KAAK,GAAW,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QAClC,EAAE,CAAC,CAAC,kBAAkB,KAAK,IAAI,CAAC,CAAC,CAAC;YAC9B,YAAY,CAAC,MAAM,CAAC,IAAI,OAAO,YAAY,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC;YAC3D,YAAY,CAAC,OAAO,CAAC,IAAI,OAAO,YAAY,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC;YAC7D,YAAY,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;YACpC,EAAE,CAAA,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAA,CAAC;gBACb,KAAK,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;YAC5B,CAAC;QACL,CAAC;QACD,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC,KAAK,EAAE,YAAY,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC;aAC5E,IAAI,CAAC,MAAM;YACR,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,kBAAkB,KAAK,IAAI,CAAC,CAAC,CAAC;gBACzC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,4EAA4E,CAAC,CAAC;YAClG,CAAC;YACD,MAAM,CAAC,cAAc,CAAC,4BAA4B,CAAC,KAAK,EAAE,4BAAY,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC;iBAC1H,IAAI,CAAC,GAAG;gBACL,IAAI,MAAM,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBACpC,MAAM,CAAC,cAAc,CAAC,2BAA2B,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC;oBACnE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;oBACtB,MAAM,CAAC,GAAG,CAAC;gBACf,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACX,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK;QACV,uBAAU,CAAC,QAAQ,CAAC,kBAAkB,KAAK,EAAE,CAAC,CAAC;QAC/C,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;AACP,CAAC;AAlCe,aAAK,QAkCpB,CAAA","file":"mongoose/mongoose-model.js","sourcesContent":["import Mongoose = require(\"mongoose\");\nimport Q = require('q');\nimport { EntityChange } from '../core/enums/entity-change';\nimport { getEntity } from '../core/dynamic/model-entity';\nimport * as Enumerable from 'linq';\nimport { winstonLog } from '../logging/winstonLog';\nimport * as mongooseHelper from './mongoose-model-helper';\nimport * as CoreUtils from \"../core/utils\";\nimport * as Utils from './utils';\nimport {QueryOptions} from '../core/interfaces/queryOptions';\nimport {MetaUtils} from \"../core/metadata/utils\";\nimport {Decorators} from '../core/constants/decorators';\nimport {GetRepositoryForName} from '../core/dynamic/dynamic-repository';\n\n/**\n * Iterate through objArr and check if any child object need to be added. If yes, then add those child objects.\n * Bulk create these updated objects.\n * Usage - Post multiple objects parallely\n * @param model\n * @param objArr\n */\nexport function bulkPost(model: Mongoose.Model<any>, objArr: Array<any>): Q.Promise<any> {\n    var addChildModel = [];\n\n    // create all cloned models\n    var clonedModels = [];\n    Enumerable.from(objArr).forEach(obj => {\n        var cloneObj = mongooseHelper.removeTransientProperties(model, obj);\n        clonedModels.push(cloneObj);\n        addChildModel.push(mongooseHelper.addChildModelToParent(model, cloneObj, null));\n    });\n\n    return Q.allSettled(addChildModel)\n        .then(result => {\n            // autogenerate ids of all the objects\n            Enumerable.from(clonedModels).forEach(clonedObj => {\n                try {\n                    mongooseHelper.autogenerateIdsForAutoFields(model, clonedObj);\n                    //Object.assign(obj, clonedObj);\n                } catch (ex) {\n                    winstonLog.logError(`Error in bulkPost ${ex}`);\n                    return Q.reject(ex);\n                }\n            });\n\n            return Q.nbind(model.create, model)(clonedModels).then(result => {\n                return Enumerable.from(result).select(x => Utils.toObject(x)).toArray();\n            })\n                .catch(error => {\n                    winstonLog.logError(`Error in bulkPost ${error}`);\n                    return Q.reject(error);\n                })\n        });\n}\n\n/**\n * Iterate through objArr and call put for these\n * Usage - Update multiple object sequentially\n * @param model\n * @param objArr\n */\nexport function bulkPut(model: Mongoose.Model<any>, objArr: Array<any>): Q.Promise<any> {\n    var asyncCalls = [];\n    var length = objArr.length;\n    var ids = objArr.map(x => x._id);\n    var bulk = model.collection.initializeUnorderedBulkOp();\n    var asyncCalls = [];\n\n    // classic for loop used gives high performanance\n    for (var i = 0; i < length; i++) {\n        asyncCalls.push(mongooseHelper.addChildModelToParent(model, objArr[i], objArr[i]._id).then(result => {\n            var objectId = new Mongoose.Types.ObjectId(result._id);\n            delete result._id;\n            let clonedObj = mongooseHelper.removeTransientProperties(model, result);\n            var updatedProps = Utils.getUpdatedProps(clonedObj, EntityChange.put);\n            bulk.find({ _id: objectId }).update(updatedProps);\n        }));\n    }\n\n    return Q.allSettled(asyncCalls).then(x => {\n        return Q.nbind(bulk.execute, bulk)().then(result => {\n            // update parent\n            return findMany(model, ids).then(objects => {\n                return mongooseHelper.updateParent(model, objects).then(res => {\n                    return objects;\n                });\n            });\n        }).catch(error => {\n            winstonLog.logError(`Error in bulkPut ${error}`);\n            return Q.reject(error);\n        });\n    });\n\n    //Enumerable.from(objArr).forEach(x => {\n    //    if (x['_id']) {\n    //        asyncCalls.push(put(model, x['_id'], x));\n    //    }\n    //});\n\n    //return Q.allSettled(asyncCalls)\n    //    .then(result => {\n    //        return Enumerable.from(result).select(x => x.value).toArray();\n    //    })\n    //    .catch(error => {\n    //        winstonLog.logError(`Error in bulkPut ${error}`);\n    //        return Q.reject(error);\n    //    });\n}\n\n/**\n * Iterate through objArr and call put for these\n * Usage - Update multiple object sequentially\n * @param model\n * @param objArr\n */\nexport function bulkPatch(model: Mongoose.Model<any>, objArr: Array<any>): Q.Promise<any> {\n    var asyncCalls = [];\n    var length = objArr.length;\n    var ids = objArr.map(x => x._id);\n    var bulk = model.collection.initializeUnorderedBulkOp();\n    var asyncCalls = [];\n\n    // classic for loop used gives high performanance\n    for (var i = 0; i < length; i++) {\n        asyncCalls.push(mongooseHelper.addChildModelToParent(model, objArr[i], objArr[i]._id).then(result => {\n            var objectId = new Mongoose.Types.ObjectId(result._id);\n            delete result._id;\n            let clonedObj = mongooseHelper.removeTransientProperties(model, result);\n            var updatedProps = Utils.getUpdatedProps(clonedObj, EntityChange.patch);\n            bulk.find({ _id: objectId }).update(updatedProps);\n        }));\n    }\n\n    return Q.allSettled(asyncCalls).then(x => {\n        return Q.nbind(bulk.execute, bulk)().then(result => {\n            // update parent\n            return findMany(model, ids).then(objects => {\n                return mongooseHelper.updateParent(model, objects).then(res => {\n                    return objects;\n                });\n            });\n        }).catch(error => {\n            winstonLog.logError(`Error in bulkPut ${error}`);\n            return Q.reject(error);\n        });\n    });\n}\n\n/**\n * Bulk update objects. Find updated objects, and update the parent docs\n * Usage - Update multiple objects parallely with same porperty set\n * @param model\n * @param objIds\n * @param obj\n */\nexport function bulkPutMany(model: Mongoose.Model<any>, objIds: Array<any>, obj: any): Q.Promise<any> {\n    delete obj._id;\n    let clonedObj = mongooseHelper.removeTransientProperties(model, obj);\n    // First update the any embedded property and then update the model\n    var cond = {};\n    cond['_id'] = {\n        $in: objIds\n    };\n    var updatedProps = Utils.getUpdatedProps(clonedObj, EntityChange.put);\n    return Q.nbind(model.update, model)(cond, updatedProps, { multi: true })\n        .then(result => {\n            return findMany(model, objIds).then(objects => {\n                return mongooseHelper.updateParent(model, objects).then(res => {\n                    return result;\n                });\n            });\n        }).catch(error => {\n            winstonLog.logError(`Error in put ${error}`);\n            return Q.reject(error);\n        });\n}\n\n/**\n * Usage - Find all the objects\n * @param model\n */\nexport function findAll(model: Mongoose.Model<any>): Q.Promise<any> {\n    return Q.nbind(model.find, model)({})\n        .then(result => {\n            return Utils.toObject(result);\n        }).catch(error => {\n            winstonLog.logError(`Error in findAll ${error}`);\n            return Q.reject(error);\n        });\n}\n\n\n/**\n * Query collection and then populate child objects with relationship\n * Usage - Search object with given condition\n * @param model\n * @param query \n */\nexport function countWhere(model: Mongoose.Model<any>, query: any): Q.Promise<any> {\n    \n    let queryObj = model.find(query).count();    \n    //winstonLog.logInfo(`findWhere query is ${query}`);\n    return Q.nbind(queryObj.exec, queryObj)()\n        .then(result => {\n            // update embedded property, if any\n            return Q.resolve(result);\n        }).catch(error => {\n            winstonLog.logError(`Error in countWhere ${error}`);\n            return Q.reject(error);\n        });\n    \n}\n\nexport function distinctWhere(model: Mongoose.Model<any>, query: any): Q.Promise<any> {\n\n    let queryObj = model.find(query).distinct();\n    //winstonLog.logInfo(`findWhere query is ${query}`);\n    return Q.nbind(queryObj.exec, queryObj)()\n        .then(result => {\n            // update embedded property, if any\n            return Q.resolve(result);\n        }).catch(error => {\n            winstonLog.logError(`Error in distinctWhere ${error}`);\n            return Q.reject(error);\n        });\n\n}\n\n\n/**\n * Query collection and then populate child objects with relationship\n * Usage - Search object with given condition\n * @param model\n * @param query\n * @param select {Array<string> | any} In case it is an array of string, it selects the specified keys mentioned in the array. In case  it is an Object, it sets the JS object as the projection key\n * @param sort\n * @param skip\n * @param limit\n */\nexport function findWhere(model: Mongoose.Model<any>, query: any, select?: Array<string> | any, queryOptions?: QueryOptions, toLoadChilds?: boolean, sort?: any, skip?: number, limit?: number): Q.Promise<any> {\n    var sel = {};\n    if (select instanceof Array) {\n        select.forEach(x => {\n            sel[x] = 1;\n        });\n    }\n    else if (select) {\n        sel = select;\n    }\n    if (queryOptions) {\n        if (queryOptions.limit != null)\n            limit = queryOptions.limit;\n\n        if (queryOptions.skip != null)\n            skip = queryOptions.skip;\n\n        if (queryOptions.sort != null)\n            sort = queryOptions.sort;\n    }\n\n    let queryObj = model.find(query, sel);\n    if (sort) {\n        queryObj = queryObj.sort(sort);\n    }\n    if (skip) {\n        queryObj = queryObj.skip(skip);\n    }\n    if (limit) {\n        queryObj = queryObj.limit(limit);\n    }\n    //winstonLog.logInfo(`findWhere query is ${query}`);\n    return Q.nbind(queryObj.exec, queryObj)()\n        .then(result => {\n            // update embedded property, if any\n            if (toLoadChilds != undefined && toLoadChilds == false) {\n                return Utils.toObject(result);\n            }\n\n            var asyncCalls = [];\n            Enumerable.from(result).forEach(x => {\n                asyncCalls.push(mongooseHelper.embeddedChildren(model, x, false));\n            });\n            return Q.allSettled(asyncCalls).then(r => {\n                return Enumerable.from(r).select(x => Utils.toObject(x.value)).toArray();\n            });\n        }).catch(error => {\n            winstonLog.logError(`Error in findWhere ${error}`);\n            return Q.reject(error);\n        });\n    // winstonLog.logInfo(`findWhere query is ${query}`);\n    // return Q.nbind(model.find, model)(query)\n    //     .then(result => {\n    //         return toObject(result);\n    //     }).catch(error => {\n    //         winstonLog.logError(`Error in findWhere ${error}`);\n    //         return error;\n    //     });\n}\n\n/**\n * Usage - find object with given object id\n * @param model\n * @param id\n */\nexport function findOne(model: Mongoose.Model<any>, id) {\n    return Q.nbind(model.findOne, model)({ '_id': id })\n        .then(result => {\n            return mongooseHelper.embeddedChildren(model, result, false)\n                .then(r => {\n                    return Utils.toObject(r);\n                });\n        }).catch(error => {\n            winstonLog.logError(`Error in findOne ${error}`);\n            return Q.reject(error);\n        });\n}\n\n/**\n * Usage - find the object with given {property : value}\n * @param model\n * @param fieldName\n * @param value\n */\nexport function findByField(model: Mongoose.Model<any>, fieldName, value): Q.Promise<any> {\n    var param = {};\n    param[fieldName] = value;\n    return Q.nbind(model.findOne, model)(param)\n        .then(result => {\n            return mongooseHelper.embeddedChildren(model, result, false)\n                .then(r => {\n                    return Utils.toObject(r);\n                });\n        },\n        err => {\n            winstonLog.logError(`Error in findByField ${err}`);\n            return Q.reject(err);\n        });\n}\n\n/**\n * Usage - Find all the objects with given ids\n * @param model\n * @param ids\n */\nexport function findMany(model: Mongoose.Model<any>, ids: Array<any>, toLoadEmbeddedChilds?: boolean) {\n    if (toLoadEmbeddedChilds == undefined) {\n        toLoadEmbeddedChilds = false;\n    }\n    return Q.nbind(model.find, model)({\n        '_id': {\n            $in: ids\n        }\n    }).then((result: any) => {\n        if (result.length !== ids.length) {\n            var error = 'findmany - numbers of items found:' + result.length + 'number of items searched: ' + ids.length;\n            winstonLog.logError(`Error in findMany ${error}`);\n            return Q.reject(error);\n        }\n\n        var asyncCalls = [];\n        if (toLoadEmbeddedChilds) {\n            Enumerable.from(result).forEach(x => {\n                asyncCalls.push(mongooseHelper.embeddedChildren(model, x, false));\n            });\n            return Q.allSettled(asyncCalls).then(r => {\n                return Enumerable.from(r).select(x => Utils.toObject(x.value)).toArray();\n            });\n        } else {\n            return Utils.toObject(result);\n        }\n\n    });\n}\n\n/**\n * find object with the given id.\n * Check if property has a relationship. If yes, then find all the child objects and return child\n * @param model\n * @param id\n * @param prop\n */\nexport function findChild(model: Mongoose.Model<any>, id, prop): Q.Promise<any> {\n    return Q.nbind(model.findOne, model)({ '_id': id })\n        .then(result => {\n            var res = Utils.toObject(result)[prop];\n            var metas = CoreUtils.getAllRelationsForTargetInternal(getEntity(model.modelName));\n            if (Enumerable.from(metas).any(x => x.propertyKey == prop)) {\n                // create new object and add only that property for which we want to do eagerloading\n                var result = {};\n                result[prop] = res;\n                return mongooseHelper.embeddedChildren(model, result, true)\n                    .then(r => {\n                        return result[prop];\n                    });\n            }\n            return res;\n        }).catch(error => {\n            winstonLog.logError(`Error in findChild ${error}`);\n            return Q.reject(error);\n        });\n}\n\n/**\n * case 1: all new - create main item and child separately and embed if true\n * case 2: some new, some update - create main item and update/create child accordingly and embed if true\n * @param obj\n */\nexport function post(model: Mongoose.Model<any>, obj: any): Q.Promise<any> {\n    let clonedObj = mongooseHelper.removeTransientProperties(model, obj);\n    return mongooseHelper.addChildModelToParent(model, clonedObj, null)\n        .then(result => {\n            try {\n                mongooseHelper.autogenerateIdsForAutoFields(model, clonedObj);\n                //Object.assign(obj, clonedObj);\n            } catch (ex) {\n                console.log(ex);\n                return Q.reject(ex);\n            }\n            return Q.nbind(model.create, model)(new model(clonedObj)).then(result => {\n                let resObj = Utils.toObject(result);\n                Object.assign(obj, resObj);\n                return obj;\n            });\n        }).catch(error => {\n            winstonLog.logError(`Error in post ${error}`);\n            return Q.reject(error);\n        });\n}\n\n/**\n * Delete object with given id. Check if, any children have deletecase=true, then delete children from master table\n * Update parent document for all the deleted objects\n * Usage - Delete object given id\n * @param model\n * @param id\n */\nexport function del(model: Mongoose.Model<any>, id: any): Q.Promise<any> {\n    return Q.nbind(model.findOneAndRemove, model)({ '_id': id })\n        .then((response: any) => {\n            return mongooseHelper.deleteCascade(model, Utils.toObject(response)).then(x => {\n                return mongooseHelper.updateEmbeddedOnEntityChange(model, EntityChange.delete, response, null)\n                    .then(res => {\n                        return ({ delete: 'success' });\n                    });\n            });\n        })\n        .catch(err => {\n            winstonLog.logError(`delete failed ${err}`);\n            return Q.reject({ delete: 'failed', error: err });\n        });\n}\n\n/**\n * Sequetially delete the objects\n * @param modelte\n * @param ids\n */\nexport function bulkDel(model: Mongoose.Model<any>, objs: Array<any>): Q.Promise<any> {\n    var asyncCalls = [];\n    var ids = [];\n    Enumerable.from(objs).forEach(x => {\n        if (CoreUtils.isJSON(x)) {\n            ids.push(x._id);\n        }\n        else {\n            ids.push(x);\n        }\n    });\n    ids.forEach(x => {\n        asyncCalls.push(del(model, x));\n    });\n\n    return Q.allSettled(asyncCalls)\n        .then(result => {\n            var ret = [];\n            Enumerable.from(result).forEach(x => {\n                if (x.value) ret.push(x.value);\n                if (x.reason) ret.push(x.reason);\n            });\n            return ret;\n        })\n        .catch(err => {\n            winstonLog.logError(`bulkDel failed ${err}`);\n            return Q.reject('bulkDel failed');\n        });\n}\n\n/**\n * Check whether decorator is applied or not.\n * @param path\n * @param decorator\n * @param propertyKey\n */\nfunction isDecoratorApplied(path: any, decorator: string, propertyKey: string) {\n    var isDecoratorPresent: boolean = false;\n    let repo = GetRepositoryForName(path);\n    var repoEntity = repo && repo.getEntityType();\n    var optimisticLock = repoEntity && MetaUtils.getMetaData(repoEntity, decorator, propertyKey);\n    if (optimisticLock) {\n        isDecoratorPresent = true;\n    }\n    return isDecoratorPresent;\n}\n/**\n * Check if any child object need to be added, if yes, then add those child objects.\n * update the object with propertie. And then update the parent objects.\n * Usage - Update the object with given object id\n * @param model\n * @param id\n * @param obj\n */\nexport function put(model: Mongoose.Model<any>, id: any, obj: any, path?: string): Q.Promise<any> {\n    let clonedObj = mongooseHelper.removeTransientProperties(model, obj);\n    // First update the any embedded property and then update the model\n    return mongooseHelper.addChildModelToParent(model, clonedObj, id).then(result => {\n        var updatedProps = Utils.getUpdatedProps(clonedObj, EntityChange.put);\n        let isDecoratorPresent = isDecoratorApplied(path, Decorators.OPTIMISTICLOCK, \"put\");\n        let query: Object = { '_id': id };\n        if (isDecoratorPresent === true) {\n            updatedProps[\"$set\"] && delete updatedProps[\"$set\"][\"__v\"];\n            updatedProps[\"$inc\"] = { '__v': 1 };\n            query[\"__v\"] = obj[\"__v\"];\n        }\n        return Q.nbind(model.findOneAndUpdate, model)(query, updatedProps, { new: true })\n            .then(result => {\n                if (!result && isDecoratorPresent === true) {\n                    return Q.reject(\"You are trying to update with stale data,please try again after some time.\");\n                }\n                return mongooseHelper.updateEmbeddedOnEntityChange(model, EntityChange.put, result, Utils.getPropertiesFromObject(clonedObj))\n                    .then(res => {\n                        var resObj = Utils.toObject(result);\n                        return mongooseHelper.fetchEagerLoadingProperties(model, resObj).then(r => {\n                            Object.assign(obj, r);\n                            return obj;\n                        });\n                    });\n            }).catch(error => {\n                winstonLog.logError(`Error in put ${error}`);\n                return Q.reject(error);\n            });\n    }).catch(error => {\n        winstonLog.logError(`Error in put ${error}`);\n        return Q.reject(error);\n    });\n}\n\n/**\n * Check if any child object need to be added, if yes, then add those child objects.\n * update the object with propertie. And then update the parent objects.\n * Usage - Update the object with given object id\n * @param model\n * @param id\n * @param obj\n */\nexport function patch(model: Mongoose.Model<any>, id: any, obj, path?: string): Q.Promise<any> {\n    let clonedObj = mongooseHelper.removeTransientProperties(model, obj);\n    \n    // First update the any embedded property and then update the model\n    return mongooseHelper.addChildModelToParent(model, clonedObj, id).then(result => {\n        var updatedProps = Utils.getUpdatedProps(clonedObj, EntityChange.patch);\n        let isDecoratorPresent = isDecoratorApplied(path, Decorators.OPTIMISTICLOCK, \"patch\");\n        let query: Object = { '_id': id };\n        if (isDecoratorPresent === true) {\n            updatedProps[\"$set\"] && delete updatedProps[\"$set\"][\"__v\"];\n            updatedProps[\"$push\"] && delete updatedProps[\"$push\"][\"__v\"];\n            updatedProps[\"$inc\"] = { '__v': 1 };\n            if(obj[\"__v\"]){\n              query[\"__v\"] = obj[\"__v\"];\n            }\n        }\n        return Q.nbind(model.findOneAndUpdate, model)(query, updatedProps, { new: true })\n            .then(result => {\n                if (!result && isDecoratorPresent === true) {\n                    return Q.reject(\"You are trying to update with stale data,please try again after some time.\");\n                }\n                return mongooseHelper.updateEmbeddedOnEntityChange(model, EntityChange.patch, result, Utils.getPropertiesFromObject(clonedObj))\n                    .then(res => {\n                        var resObj = Utils.toObject(result);\n                        return mongooseHelper.fetchEagerLoadingProperties(model, resObj).then(r => {\n                            Object.assign(obj, r);\n                            return obj;\n                        });\n                    });\n            });\n    }).catch(error => {\n        winstonLog.logError(`Error in patch ${error}`);\n        return Q.reject(error);\n    });\n}"],"sourceRoot":"/source/"}